# ========================================
# application.yml - UPDATED
# ========================================

spring:
  application:
    name: editor-server-main

  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration
    baseline-version: 0
  jpa:
    hibernate:
      ddl-auto: update

  data:
    redis:
      host: redis
      port: 6379
      password: redis_pass
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 20
          max-idle: 10
          min-idle: 5

# Application-specific configuration
editor:
  buffer:
    flush-interval-ms: 500
    max-buffer-size: 50
    max-wait-time-ms: 1000
  server:
    id: ${SERVER_ID:server-1}
  snapshot:
    datasource:
      url: jdbc:postgresql://postgres-snapshot:5432/snapshot_db
      username: snapshot_user
      password: snapshot_pass

# JWT Configuration - OAuth2 Resource Server
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: http://auth-server:8080
          jwk-set-uri: http://auth-server:8080/.well-known/jwks.json

# Debezium CDC configuration
debezium:
  topic:
    name: postgres-primary.editor_db.crdt_operations
  consumer:

# Application configuration for WebSocket routing
app:
  client:
    base-url: ${NGINX_CLIENT_BASE_URL:localhost:4200}
  environment: ${ENVIRONMENT:development}

# ZooKeeper configuration
zookeeper:
  connection-string: ${ZOOKEEPER_CONNECT:zookeeper:2181}
  session-timeout: 30000
  connection-timeout: 15000

# Enable detailed logging for debugging
logging:
  level:
    org.flywaydb: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
    com.mmtext: DEBUG

---
# Profile for Kubernetes (when ready)
spring:
  config:
    activate:
      on-profile: kubernetes

app:
  client:
    base-url: editor.yourdomain.com
  environment: kubernetes

logging:
  level:
    com.mmtext: INFO
    org.springframework.web.socket: DEBUG

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: always
# CORS Configuration
cors:
  allowed-origins: ${CORS_ORIGINS:http://client-app,http://localhost:4200}
  allowed-methods: ${CORS_ALLOWED_METHODS:GET,POST,PUT,DELETE,OPTIONS}
  allowed-headers: ${CORS_ALLOWED_HEADERS:Content-Type,Authorization,X-CSRF-TOKEN,DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Range}
  allow-credentials: ${CORS_ALLOW_CREDENTIALS:true}
  exposed-headers: Set-Cookie
  max-age: ${CORS_MAX_AGE:3600}