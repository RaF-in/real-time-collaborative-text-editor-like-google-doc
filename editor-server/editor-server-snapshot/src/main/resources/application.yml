spring:
  application:
    name: editor-server-snapshot
  kafka:
    bootstrap-servers: kafka-1:19092,kafka-2:19092,kafka-3:19092
    consumer:
      # Group ID will be set by KafkaConfig
      auto-offset-reset: earliest         # Start from beginning if no offset
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.apache.kafka.common.serialization.StringDeserializer

      # Single message processing for reliability
      max-poll-records: 1                  # Process one record at a time
      enable-auto-commit: false            # Manual commit for better control
      fetch-min-bytes: 1                   # Minimum fetch size
      fetch-max-wait: 500                  # Max wait for fetch

      # Connection settings
      session-timeout-ms: 30000
      heartbeat-interval-ms: 10000
      max-poll-interval-ms: 300000        # 5 minutes

      # Reliability settings
      properties:
        # Add retry configuration
        retry.backoff.ms: 1000
        retry.topic.dlq.enable: true

    # Single message listener
    listener:
      ack-mode: manual_immediate
      concurrency: 1                       # Single consumer for ordering

  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        format_sql: true
        jdbc:
          batch_size: 20
        order_inserts: true
        order_updates: true

# Debezium configuration
debezium:
  topic:
    name: editor-server-main.public.crdt_operation_outbox_events
  consumer:
    group: editor-server-snapshot-cdc-consumer

# Logging configuration
logging:
  level:
    com.mmtext.editorserversnapshot: INFO
    org.apache.kafka: WARN
    org.springframework.kafka: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level [%X{traceId}] %logger{36} - %msg%n"