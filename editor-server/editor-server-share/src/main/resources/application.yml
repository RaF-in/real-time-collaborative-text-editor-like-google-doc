
spring:
  application:
    name: editor-server-share

  # DataSource Configuration
  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5435/share_db}
    username: ${SPRING_DATASOURCE_USERNAME:admin}
    password: ${SPRING_DATASOURCE_PASSWORD:admin}
    driver-class-name: org.postgresql.Driver

  mail:
    host: ${MAIL_HOST:smtp.gmail.com}
    port: ${MAIL_PORT:587}
    username: ${MAIL_USERNAME:your-email@gmail.com}
    password: ${MAIL_PASSWORD:your-app-password}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true

  # JPA Configuration
  jpa:
    hibernate:
      ddl-auto: update  # Use Flyway for schema management
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect

  # Flyway Configuration
  flyway:
    enabled: true
    baseline-on-migrate: true
    baseline-version: 0
    locations: classpath:db/migration
    validate-on-migrate: true

# Actuator Configuration
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: always
      show-components: always
  health:
    circuitbreakers:
      enabled: true
  info:
    env:
      enabled: true

# gRPC Server Configuration
grpc:
  server:
    port: ${GRPC_SERVER_PORT:50092}
    maxInboundMessageSize: ${GRPC_MAX_INBOUND_MESSAGE_SIZE:10485760}  # 10MB
    keepAliveTime: ${GRPC_KEEP_ALIVE_TIME:30s}
    keepAliveTimeout: ${GRPC_KEEP_ALIVE_TIMEOUT:5s}
    keepAliveWithoutCalls: ${GRPC_KEEP_ALIVE_WITHOUT_CALLS:true}

# Custom service configuration
  # JWT Configuration - OAuth2 Resource Server
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: http://auth-server:8080
          jwk-set-uri: http://auth-server:8080/.well-known/jwks.json
  grpc:
  auth:
    service:
      host: ${AUTH_GRPC_HOST:auth-server}
      port: ${AUTH_GRPC_PORT:9090}
  editor:
    service:
      host: ${EDITOR_GRPC_HOST:editor-server-snapshot-1}
      port: ${EDITOR_GRPC_PORT:9091}
editor:
  service:
    url: ${EDITOR_SERVICE_URL:http://nginx/api}

# Resilience4j Configuration for Circuit Breaker and Retry
resilience4j:
  circuitbreaker:
    instances:
      authService:
        registerHealthIndicator: true
        slidingWindowSize: 10
        minimumNumberOfCalls: 5
        permittedNumberOfCallsInHalfOpenState: 3
        automaticTransitionFromOpenToHalfOpenEnabled: true
        waitDurationInOpenState: 5s
        failureRateThreshold: 50
        recordExceptions:
          - io.grpc.StatusRuntimeException
      editorService:
        registerHealthIndicator: true
        slidingWindowSize: 10
        minimumNumberOfCalls: 5
        permittedNumberOfCallsInHalfOpenState: 3
        automaticTransitionFromOpenToHalfOpenEnabled: true
        waitDurationInOpenState: 5s
        failureRateThreshold: 50
        recordExceptions:
          - io.grpc.StatusRuntimeException

  retry:
    instances:
      authService:
        maxAttempts: 3
        waitDuration: 1s
        retryExceptions:
          - io.grpc.StatusRuntimeException
      editorService:
        maxAttempts: 3
        waitDuration: 1s
        retryExceptions:
          - io.grpc.StatusRuntimeException

# Mail Configuration

# CORS Configuration
cors:
  allowed-origins: ${CORS_ORIGINS:http://localhost:4200}
  allowed-methods: ${CORS_ALLOWED_METHODS:GET,POST,PUT,DELETE,OPTIONS}
  allowed-headers: ${CORS_ALLOWED_HEADERS:Content-Type,Authorization,X-CSRF-TOKEN,DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Range}
  allow-credentials: ${CORS_ALLOW_CREDENTIALS:true}
  max-age: ${CORS_MAX_AGE:3600}

# Application-specific configuration
app:
  frontend-url: ${FRONTEND_URL:http://localhost:4200}
  backend-url: ${BACKEND_URL:http://localhost:8080}
  name: ${APP_NAME:Editor App}
